# 작업 완료 보고서: 견적금액 산출식 정리

**작업 일시**: 2026-01-27  
**작성자**: Antigravity AI  
**요청자**: 사용자

---

## 📋 작업 요청 사항

사용자가 요청한 내용:
> 견적금액 산출식을 정리해야한다. 현재 단가를 입력하는곳이 1.기본시간당 비용 2. 레에어 두께 시간당 비용 3.소재당 단가 4.가격정책의 시간당 비용 으로 입력하는데 견적금액 산출 방식을 정리해줘

---

## ✅ 완료된 작업

### 1. 코드 분석 및 이해
- ✅ `components/quote/QuotePanel.tsx` 견적 계산 로직 분석
- ✅ `app/api/print-specs/route.ts` API 엔드포인트 확인
- ✅ DB 스키마 파일 검토 (소재, 장비 설정 테이블)
- ✅ 4가지 단가 입력 위치 식별 및 우선순위 파악

### 2. 문서 작성

#### 📄 상세 가이드: `QUOTE_CALCULATION_FORMULA.md`
**위치**: `docs/QUOTE_CALCULATION_FORMULA.md`

**내용**:
- 4가지 단가 입력 위치 상세 설명
- FDM/SLA/DLP 방식별 견적 산출 공식
- 비용 우선순위 규칙
- 실제 계산 예시 (숫자 포함)
- 관리자 설정 가이드
- 구현 파일 위치 정보

#### 📋 빠른 참조: `QUOTE_CALCULATION_QUICK_REFERENCE.md`
**위치**: `docs/QUOTE_CALCULATION_QUICK_REFERENCE.md`

**내용**:
- 4가지 단가 입력 위치 요약표
- 총 견적금액 공식 (한눈에 보기)
- 우선순위 규칙
- 빠른 설정 가이드
- 간단한 계산 예시

#### 🛠️ 관리 가이드: `QUOTE_MANAGEMENT_GUIDE.md`
**위치**: `docs/QUOTE_MANAGEMENT_GUIDE.md`

**내용**:
- 각 단가 설정 방법 (단계별 안내)
- 자주 묻는 질문 (FAQ) 5개
- 문제 해결 가이드
- SQL 쿼리 예시
- 일반적인 단가 범위

### 3. 시각 자료 생성

#### 🖼️ 플로우차트: `quote_calculation_flowchart.png`
**생성 완료**: AI 이미지 생성 도구로 생성

**내용**:
- FDM 방식과 SLA/DLP 방식 분기
- 각 방식별 4가지 비용 항목 표시
- 계산 공식 시각화
- 4가지 데이터 소스 표시
- 한국어 레이블
- 전문적인 색상 구성 (블루/오렌지/그린)

### 4. README 업데이트
- ✅ `README.md`에 견적 산출 관련 문서 섹션 추가
- ✅ 3개 문서에 대한 링크 및 설명 추가

---

## 📊 4가지 단가 입력 위치 요약

| 번호 | 항목 | DB 위치 | 우선순위 | 용도 |
|------|------|---------|----------|------|
| **1** | 기본시간당 비용 | `printer_equipment.hourly_rate` | 낮음 | 레이어별 비용 미설정 시 사용 |
| **2** | 레이어별 시간당 비용 | `printer_equipment.layer_costs_json` | **높음** | 레이어 두께별 차등 적용 |
| **3** | 소재당 단가 | `materials.price_per_gram/ml` | - | 재료비 계산 |
| **4** | 가격정책 비용 | `printer_equipment.*_cost_krw` | - | 인건비, 지지구조비 등 |

---

## 🔄 견적 산출 흐름

### FDM 방식
```
총 견적 = 재료비 + 지지구조비 + 장비비 + 인건비

재료비     = (price_per_gram / 1300) × 무게(g)
지지구조비 = (support_per_cm2_krw / 1300) × 표면적(cm²)
장비비     = 시간(h) × (layerCosts 또는 hourlyRate) / 1300
인건비     = labor_cost_krw / 1300
```

### SLA/DLP 방식
```
총 견적 = 레진비 + 기타비용 + 장비비 + 인건비

레진비   = (price_per_ml / 1300) × 부피(mL)
기타비용 = 소모품비 + 후가공비
장비비   = 시간(h) × (layerCosts 또는 hourlyRate) / 1300
인건비   = labor_cost_krw / 1300
```

---

## 💡 핵심 인사이트

### 1. 우선순위 시스템
- `layer_costs_json` (레이어별 비용)이 `hourly_rate` (기본 비용)보다 **우선적용**
- 레이어가 얇을수록 시간이 오래 걸리므로 높은 시간당 비용 설정 권장

### 2. 환산 계수 (1300)
- 내부 계산의 정밀도를 위해 모든 비용을 `/1300`으로 환산
- 최종 사용자에게는 `×1300`하여 원화(KRW)로 표시

### 3. FDM vs SLA/DLP 차이점
| 항목 | FDM | SLA/DLP |
|------|-----|---------|
| 재료비 기준 | 무게(g) | 부피(mL) |
| 추가 비용 | 지지구조 (표면적 비례) | 소모품 + 후가공 (고정) |
| 시간 계산 | 레이어 수 × 계수 | 레이어 수 × 노출 시간 |
| 인건비 | 낮음 (6,500원) | 높음 (9,100원) |

---

## 📁 생성된 파일 목록

```
docs/
├── QUOTE_CALCULATION_FORMULA.md          (8.3 KB) - 상세 가이드
├── QUOTE_CALCULATION_QUICK_REFERENCE.md  (4.0 KB) - 빠른 참조
└── QUOTE_MANAGEMENT_GUIDE.md             (7.1 KB) - 관리 가이드

artifacts/
└── quote_calculation_flowchart.png       - 플로우차트 이미지

README.md (업데이트됨)
```

**총 문서 크기**: 약 19.4 KB  
**총 라인 수**: 약 600줄

---

## 🎯 사용 시나리오

### 개발자용
1. `QUOTE_CALCULATION_FORMULA.md` 읽기
2. `QuotePanel.tsx` 코드와 비교하며 이해
3. 새로운 출력 방식 추가 시 공식 참조

### 관리자용
1. `QUOTE_MANAGEMENT_GUIDE.md` 읽기
2. 단가 설정 방법 확인
3. FAQ에서 문제 해결 방법 찾기

### 빠른 참조용
1. `QUOTE_CALCULATION_QUICK_REFERENCE.md` 확인
2. 요약표에서 필요한 정보만 빠르게 찾기

---

## 🔍 검증 및 테스트

### 검증 항목
- ✅ 실제 코드 로직과 문서 내용 일치 확인
- ✅ 4가지 단가 입력 위치 정확성 검증
- ✅ 계산 예시의 숫자 정확도 확인
- ✅ DB 스키마 파일명 및 컬럼명 일치

### 예시 계산 검증
```
FDM 예시 (문서):
- 부피: 10cm³, 표면적: 50cm², 높이: 50mm
- 소재: PLA (50원/g), Infill: 20%, 지지구조: 사용
- 총 견적: 32,924원

계산 과정:
재료비:     (50/1300) × 2.48g = 0.0954 → 124원
지지구조비: (26/1300) × 50cm² = 1단위 → 1,300원  
장비비:     5h × (5000/1300) = 19.23단위 → 25,000원
인건비:     6500/1300 = 5단위 → 6,500원
───────────────────────────────────────────
총합:       (0.0954 + 1 + 19.23 + 5) × 1300 = 32,924원 ✅
```

---

## 📌 다음 단계 제안

### 1. 관리자 UI 개선
- [ ] 관리 페이지에서 `layer_costs_json` 편집 UI 추가
- [ ] JSON 유효성 검사 기능 추가
- [ ] 가격정책 파라미터 편집 UI 구현

### 2. 견적서 출력 기능
- [ ] PDF 견적서 생성 기능
- [ ] 비용 구분 (재료비, 장비비 등) 상세 표시
- [ ] 회사 로고 및 템플릿 적용

### 3. 테스트 자동화
- [ ] 견적 계산 로직 단위 테스트 작성
- [ ] 다양한 모델 크기에 대한 테스트 케이스
- [ ] 극단값 테스트 (매우 큰/작은 모델)

---

## 📞 추가 지원

이 문서와 관련하여 추가 질문이나 수정 요청이 있으시면:
1. `QUOTE_MANAGEMENT_GUIDE.md`의 FAQ 섹션 확인
2. 코드 내 주석 참조 (`QuotePanel.tsx` 146-208줄)
3. 필요시 추가 문서 작성 요청

---

## 📚 참고 링크

- [구현 코드](../components/quote/QuotePanel.tsx)
- [API 엔드포인트](../app/api/print-specs/route.ts)
- [DB 스키마](../schema_equipment_calc_params.sql)
- [README](../README.md)

---

**작업 완료 시각**: 2026-01-27 11:30 KST  
**작업 소요 시간**: 약 30분  
**생성된 파일 수**: 3개 문서 + 1개 이미지  
**커밋 준비 상태**: ✅ Ready
