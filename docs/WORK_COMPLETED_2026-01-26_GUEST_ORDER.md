# 🔧 작업 완료 보고서

## 📅 작업 일자: 2026-01-26

---

## ✅ 완료된 작업: 비회원 주문/결제 기능 구현

### 📋 작업 개요
로그인하지 않은 사용자도 장바구니에서 바로 주문을 진행할 수 있도록 **비회원 결제** 기능을 활성화했습니다. 비회원 주문 시에는 회원 혜택이 제한됨을 안내하고, 주문 조회를 위한 필수 정보를 수집하도록 로직을 개선했습니다.

---

## 🛠️ 구현 상세

### 1. 데이터베이스 스키마 마이그레이션

**문제점**: 기존 `orders` 테이블은 `user_id`가 필수(NOT NULL)여서 비회원 주문 생성이 불가능했습니다.

**해결**:
- `orders` 테이블을 재설계하여 마이그레이션했습니다.
- `user_id`: **NULL 허용**으로 변경.
- `guest_email`: 비회원 연락처 및 조회용 컬럼 추가.
- `session_id`: 비회원 식별을 위한 세션 ID 컬럼 추가.

### 2. 주문서 작성 페이지 (`app/checkout/page.tsx`)

**비회원 진입 시**:
- **이메일 입력 필드**가 자동으로 표시되며 **필수 항목**으로 설정됩니다.
- **[비회원 주문 유의사항]** 박스를 추가하여 다음 내용을 안내합니다:
  - ⚡ 포인트 적립 불가
  - ⚡ 주문번호/이메일로만 조회 가능
  - 회원 전용 쿠폰 사용 불가
- 로그인 유도 메시지는 유지하되, 강제하지 않고 자연스럽게 주문 진행이 가능합니다.

### 3. 주문 생성 API (`app/api/orders/route.ts`)

**로직 수정**:
- 요청 시 `Authorization` 헤더가 없어도 `X-Session-ID`가 있으면 비회원(Guest)으로 인식.
- 비회원일 경우 `guestEmail` 유효성을 검증.
- DB 저장 시 `user_id` 대신 `session_id`와 `guest_email`을 기록.
- 장바구니 삭제 로직도 `session_id` 기준으로 동작하도록 처리.

---

## 🎯 비회원 주문 프로세스

1. **장바구니 (`/cart`)**
   - 로그인 안 된 상태에서 "비회원 주문" 버튼 클릭.
   
2. **주문서 작성 (`/checkout`)**
   - **배송지 정보** 입력.
   - **연락용 이메일** 입력 (필수).
   - "주문 확정" 클릭.

3. **주문 완료 (`/order-complete`)**
   - 주문번호 발급.
   - (추후 구현 예정: 비회원 주문 조회 페이지에서 이 주문번호로 조회)

---

## 💡 제안된 비회원 정책 (기능 축소)

| 기능 | 회원 | 비회원 |
| :--- | :--- | :--- |
| **적립금** | 구매액의 N% 적립 | **적립 불가** |
| **쿠폰** | 전용 쿠폰 사용 가능 | **사용 제한** |
| **주문 관리** | 마이페이지에서 통합 관리 | **주문번호로 개별 조회** |
| **재주문** | 기존 파일/주소 불러오기 가능 | **정보 새로 입력 필요** |

---

## 🚀 배포 및 테스트

### 로컬 테스트
1. 브라우저 시크릿 모드(또는 로그아웃 상태)로 접속.
2. 장바구니에 상품 담기.
3. `/checkout` 이동.
4. 이메일 입력 후 주문 완료 테스트.
5. DB `orders` 테이블에 `user_id`가 NULL이고 `guest_email`이 들어가는지 확인.

### 배포
```bash
git add .
git commit -m "feat: 비회원 주문 결제 기능 구현 (DB 스키마 변경 및 안내 문구 추가)"
git push origin main
npm run deploy
```
